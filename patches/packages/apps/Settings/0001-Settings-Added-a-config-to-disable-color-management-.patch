From 8c5a5643865022c5152e8d412a25b4fb49b06faf Mon Sep 17 00:00:00 2001
From: Luofan Chen <clfbbn@gmail.com>
Date: Thu, 28 Jul 2022 21:21:36 +0800
Subject: [PATCH] Settings: Added a config to disable color management setting

Signed-off-by: Luofan Chen <clfbbn@gmail.com>
Change-Id: I61891fe053ef92fbc3e919712f01676304acd6ac
---
 res/values/config.xml                                        | 3 +++
 .../settings/display/ColorModePreferenceController.java      | 5 +++++
 2 files changed, 8 insertions(+)

diff --git a/res/values/config.xml b/res/values/config.xml
index 908eedbda6..5dcb30bc3f 100755
--- a/res/values/config.xml
+++ b/res/values/config.xml
@@ -535,6 +535,9 @@
     <!-- Whether to support large screen -->
     <bool name="config_supported_large_screen">false</bool>
 
+    <!-- Whether this device supports color mode management -->
+    <bool name="config_colorModeAvailable">true</bool>
+
     <!-- Display settings screen, Color mode options. Must be the same length and order as
          config_color_mode_options_values below. Only the values that also appear in
          frameworks/base/core/res/res/values/config.xml's config_availableColorModes are shown. -->
diff --git a/src/com/android/settings/display/ColorModePreferenceController.java b/src/com/android/settings/display/ColorModePreferenceController.java
index 14a2241481..218defc00e 100644
--- a/src/com/android/settings/display/ColorModePreferenceController.java
+++ b/src/com/android/settings/display/ColorModePreferenceController.java
@@ -20,6 +20,8 @@ import androidx.annotation.VisibleForTesting;
 
 import com.android.settings.core.BasePreferenceController;
 
+import com.android.settings.R;
+
 public class ColorModePreferenceController extends BasePreferenceController {
 
     public ColorModePreferenceController(Context context, String key) {
@@ -30,6 +32,9 @@ public class ColorModePreferenceController extends BasePreferenceController {
     public int getAvailabilityStatus() {
         final int[] availableColorModes = mContext.getResources().getIntArray(
                 com.android.internal.R.array.config_availableColorModes);
+        if (!this.mContext.getResources().getBoolean(R.bool.config_colorModeAvailable)) {
+            return UNSUPPORTED_ON_DEVICE;
+        }
         return mContext.getSystemService(ColorDisplayManager.class)
                 .isDeviceColorManaged()
                 && availableColorModes.length > 0
-- 
2.37.1

